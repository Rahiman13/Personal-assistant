<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bittu â€“ Jarvis View</title>
  <style>
    :root{ --bg:#070e0d; --panel:#0c1715; --panel2:#0f1e1c; --text:#e9fff6; --muted:#8be1c8; --accent:#00ff88; --speaking:#ff9a3c; --processing:#61dafb; --danger:#ff5d5d; --warning:#ffcc00; }
    html,body{ margin:0; padding:0; height:100%; background:radial-gradient(1200px 800px at 15% -10%, rgba(0,255,136,0.07), transparent 40%), linear-gradient(180deg,#06110f,#0a1413 60%,#0b1514); color:var(--text); font:14px/1.5 system-ui, Segoe UI, Roboto, Arial, sans-serif; }
    .container{ display:flex; flex-direction:column; height:100%; }
    header{ padding:10px 16px; display:flex; align-items:center; gap:12px; background:rgba(255,255,255,0.02); border-bottom:1px solid rgba(0,255,136,0.1); position:sticky; top:0; z-index:2; backdrop-filter: blur(8px); }
    .logo{ width:28px; height:28px; border-radius:8px; background:conic-gradient(from 0deg, var(--accent), #28d0b0, #28a0ff, var(--speaking)); box-shadow:0 0 18px rgba(0,255,136,0.25); }
    .brand{ font-weight:700; letter-spacing:0.6px; color:var(--accent); }
    .header-actions{ margin-left:auto; display:flex; align-items:center; gap:10px; }
    .status{ display:flex; align-items:center; gap:10px; padding-right:8px; border-right:1px solid rgba(0,255,136,0.1); }
    .dot{ width:10px; height:10px; border-radius:50%; opacity:0.35; box-shadow:0 0 0 rgba(0,0,0,0); transition: all 160ms ease; }
    #dot-listening{ background:var(--accent); }
    #dot-processing{ background:var(--processing); }
    #dot-speaking{ background:var(--speaking); }
    .dot.active{ opacity:1; box-shadow:0 0 12px currentColor; }
    #statusBar{ color:var(--muted); font-size:12px; }
    .btn{ padding:8px 10px; border-radius:8px; border:1px solid rgba(0,255,136,0.25); background:linear-gradient(180deg, rgba(0,255,136,0.14), rgba(0,255,136,0.08)); color:var(--text); cursor:pointer; }
    .btn:hover{ border-color: rgba(0,255,136,0.6); }
    main{ display:grid; grid-template-columns: 1.5fr 1fr; gap:14px; padding:14px; flex:1; min-height:0; }
    .panel{ background:var(--panel); border:1px solid rgba(0,255,136,0.08); border-radius:12px; box-shadow: 0 10px 40px rgba(0,0,0,0.35) inset, 0 1px 0 rgba(255,255,255,0.03); overflow:hidden; }
    .panel h3{ margin:0; padding:10px 12px; font-weight:700; color:#bdf6e3; background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.00)); border-bottom:1px solid rgba(0,255,136,0.06); font-size:13px; letter-spacing:0.3px; display:flex; align-items:center; justify-content:space-between; }
    .viz-wrap{ position:relative; aspect-ratio: 16/9; min-height:380px; display:flex; align-items:center; justify-content:center; background:radial-gradient(800px 300px at 15% 0%, rgba(0,255,136,0.05), transparent 60%); }
    .viz-wrap::before{ content:""; position:absolute; inset:10px; border-radius:12px; pointer-events:none; background:radial-gradient(600px 200px at 20% 0%, rgba(0,255,136,0.06), transparent 60%); border:1px solid rgba(0,255,136,0.06); }
    #brainCanvas{ width:95%; height:95%; max-width:100%; max-height:100%; display:block; }
    .log{ height:360px; overflow:auto; padding:10px 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:linear-gradient(180deg, rgba(0,0,0,0.15), rgba(0,0,0,0.05)); }
    .log-entry{ padding:6px 8px; border-radius:6px; margin-bottom:6px; border:1px solid rgba(255,255,255,0.04); background:rgba(255,255,255,0.02); }
    .log-entry .ts{ opacity:0.6; margin-right:8px; }
    .log-entry.error{ border-color: rgba(255,93,93,0.25); background: rgba(255,93,93,0.06); }
    .log-entry.warn{ border-color: rgba(255,204,0,0.25); background: rgba(255,204,0,0.06); }
    .log-entry.state{ border-color: rgba(0,255,136,0.25); background: rgba(0,255,136,0.04); }
    .inputbar{ display:flex; gap:8px; padding:10px 12px; border-top:1px solid rgba(0,255,136,0.06); background:rgba(255,255,255,0.02); }
    #cmdInput{ flex:1; padding:10px 12px; border-radius:8px; border:1px solid rgba(0,255,136,0.15); outline:none; background:#0b1716; color:var(--text); box-shadow: inset 0 1px 4px rgba(0,0,0,0.4); }
    #sendBtn{ padding:10px 14px; border-radius:8px; border:1px solid rgba(0,255,136,0.35); background:linear-gradient(180deg, rgba(0,255,136,0.15), rgba(0,255,136,0.10)); color:var(--text); cursor:pointer; }
    #sendBtn:hover{ border-color: rgba(0,255,136,0.6); }
    footer{ padding:8px 14px; font-size:12px; color:var(--muted); border-top:1px solid rgba(0,255,136,0.06); background:rgba(255,255,255,0.02); }
    @media (max-width: 980px){ main{ grid-template-columns: 1fr; } .log{ height: 240px; } }
  </style>
  <script>
    // Resize canvas to backing pixels
    function fitCanvas(canvas){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      const rect = canvas.getBoundingClientRect();
      const w = Math.max(640, Math.floor(rect.width * dpr));
      const h = Math.max(360, Math.floor(rect.height * dpr));
      if (canvas.width !== w || canvas.height !== h){ canvas.width = w; canvas.height = h; }
    }
    window.addEventListener('resize', ()=>{
      const c = document.getElementById('brainCanvas'); if (c) fitCanvas(c);
    });
    document.addEventListener('DOMContentLoaded', ()=>{
      const c = document.getElementById('brainCanvas'); if (c) fitCanvas(c);
    });
  </script>
  <!-- Uses existing JS that subscribes to SSE and renders brain animation -->
  <script defer src="http://127.0.0.1:8008/file.js"></script>
  <link rel="preconnect" href="http://127.0.0.1:8008" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: blob: http://127.0.0.1:8008; connect-src http://127.0.0.1:8008; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' http://127.0.0.1:8008;" />
  </head>
<body>
  <div class="container">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div class="brand">Bittu</div>
      <div id="statusBar">Status: Idle</div>
      <div class="header-actions">
        <div class="status">
          <div id="dot-listening" class="dot" title="Listening"></div>
          <div id="dot-processing" class="dot" title="Processing"></div>
          <div id="dot-speaking" class="dot" title="Speaking"></div>
        </div>
        <button id="clearLogBtn" class="btn" title="Clear console">Clear Log</button>
        <button id="popoutBtn" class="btn" title="Open in new window">Popout</button>
      </div>
    </header>
    <main>
      <section class="panel">
        <h3>
          <span>Neural Activity</span>
          <small style="font-weight:400;color:#8be1c8;opacity:.8">live visual</small>
        </h3>
        <div class="viz-wrap">
          <canvas id="brainCanvas"></canvas>
        </div>
      </section>
      <section class="panel">
        <h3>
          <span>Console</span>
          <small style="font-weight:400;color:#8be1c8;opacity:.8">all events & logs</small>
        </h3>
        <div id="log" class="log"></div>
        <div class="inputbar">
          <input id="cmdInput" type="text" placeholder="Type a command (or say 'Bittu ...')" />
          <button id="sendBtn">Send</button>
        </div>
      </section>
    </main>
    <footer>
      Tip: Say "Bittu, open YouTube" or type a command above.
    </footer>
  </div>
</body>
</html>

